---
import Button from "./ui/button.astro";
---

<!-- Formulario personalizado simple con manejo de envío por JavaScript -->
<div class="bg-white/80 backdrop-blur-sm p-6 rounded-lg shadow-md border border-white/30">
  <h3 class="text-2xl font-semibold text-gray-800 mb-6">Solicita una Cotización Gratis</h3>
  
  <div id="successMessage" class="hidden bg-green-100 p-4 rounded-lg mb-6">
    <div class="flex items-center">
      <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      <p class="text-green-700">¡Gracias! Tu mensaje ha sido enviado correctamente. Te responderemos pronto.</p>
    </div>
  </div>
  
  <div id="errorMessage" class="hidden bg-red-100 p-4 rounded-lg mb-6">
    <div class="flex items-center">
      <svg class="w-6 h-6 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <p class="text-red-700">Hubo un problema al enviar tu mensaje. Por favor, intenta de nuevo.</p>
    </div>
  </div>
  
  <form 
    id="contactForm" 
    class="space-y-5">
    
    <!-- Nombre -->
    <div class="mb-5">
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nombre *</label>
      <input
        id="name"
        name="name"
        type="text"
        placeholder="Tu nombre"
        required
        class="w-full px-4 py-3 border-2 placeholder:text-gray-500 rounded-md outline-none focus:ring-2 border-gray-300 focus:border-blue-500 focus:ring-blue-100"
      />
    </div>
    
    <!-- Email -->
    <div class="mb-5">
      <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
      <input
        id="email"
        name="email"
        type="email"
        placeholder="tu@email.com"
        required
        class="w-full px-4 py-3 border-2 placeholder:text-gray-500 rounded-md outline-none focus:ring-2 border-gray-300 focus:border-blue-500 focus:ring-blue-100"
      />
    </div>
    
    <!-- Teléfono -->
    <div class="mb-5">
      <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
      <input
        id="phone"
        name="phone"
        type="tel"
        placeholder="(123) 456-7890"
        class="w-full px-4 py-3 border-2 placeholder:text-gray-500 rounded-md outline-none focus:ring-2 border-gray-300 focus:border-blue-500 focus:ring-blue-100"
      />
    </div>
    
    <!-- Tipo de Servicio -->
    <div class="mb-5">
      <label for="service" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Servicio</label>
      <select
        id="service"
        name="service"
        class="w-full px-4 py-3 border-2 rounded-md outline-none focus:ring-2 border-gray-300 focus:border-blue-500 focus:ring-blue-100">
        <option value="">Selecciona un servicio</option>
        <option value="pintura">Pintura</option>
        <option value="remodelacion">Remodelación</option>
        <option value="carpinteria">Carpintería</option>
        <option value="jardineria">Jardinería</option>
        <option value="otro">Otro</option>
      </select>
    </div>
    
    <!-- Mensaje -->
    <div class="mb-5">
      <label for="message" class="block text-sm font-medium text-gray-700 mb-1">Mensaje *</label>
      <textarea
        id="message"
        name="message"
        required
        placeholder="Cuéntanos sobre tu proyecto..."
        class="w-full px-4 py-3 border-2 placeholder:text-gray-500 rounded-md outline-none h-36 focus:ring-2 border-gray-300 focus:border-blue-500 focus:ring-blue-100"
      ></textarea>
    </div>
    
    <Button id="submitButton" type="submit" size="lg" block class="bg-blue-500 hover:bg-blue-600 transition-colors w-full">
      Enviar Mensaje
    </Button>
  </form>
  
  <p class="text-sm text-gray-600 mt-3 text-center">
    Te responderemos en menos de 24 horas.
  </p>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    // Obtener referencias a los elementos del DOM
    const form = document.getElementById('contactForm');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const submitButton = document.getElementById('submitButton');
    
    // Verificar que todos los elementos existan antes de continuar
    if (!form || !successMessage || !errorMessage || !submitButton) {
      console.error('No se encontraron todos los elementos necesarios del formulario');
      return;
    }
    
    // Ahora podemos usar los elementos con seguridad
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Mostrar estado de carga
      submitButton.disabled = true;
      submitButton.innerHTML = 'Enviando...';
      
      // Recopilar datos del formulario
      const formData = new FormData(form);
      
      try {
        // Enviar datos a FormSubmit
        const response = await fetch('https://formsubmit.co/ajax/sevillaremodeling504@gmail.com', {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });
        
        const result = await response.json();
        
        if (result.success === 'true' || result.success === true) {
          // Mostrar mensaje de éxito
          form.reset();
          form.classList.add('hidden');
          successMessage.classList.remove('hidden');
          
          // Opcional: redirigir a la página de gracias después de un retraso
          setTimeout(() => {
            window.location.href = '/gracias';
          }, 2000);
        } else {
          throw new Error('Error en el envío del formulario');
        }
      } catch (error) {
        console.error('Error:', error);
        errorMessage.classList.remove('hidden');
        submitButton.disabled = false;
        submitButton.innerHTML = 'Enviar Mensaje';
      }
    });
  });
</script>
